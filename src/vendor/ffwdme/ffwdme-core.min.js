/**
 * ffwdme.js - Turn by turn navigation in the browser.
 * @version v0.4.1
 * @copyright Copyright (c) 2011-2015 Christian BÃ¤uerlein, Silvia Hundegger; 2012-2015 flinc GmbH
 * @license MIT
 */
!function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){var n=function(){};n.extend=function(t,e){var i=n.prototype.extend;n._prototyping=!0;var o=new this;i.call(o,t),o.base=function(){},delete n._prototyping;var r=o.constructor,s=o.constructor=function(){if(!n._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],o)};return s.ancestor=this,s.extend=this.extend,s.implement=this.implement,s.prototype=o,s.toString=this.toString,s.valueOf=function(t){return"object"==t?s:r.valueOf()},i.call(s,e),"function"==typeof s.init&&s.init(),s},n.prototype={extend:function(t,e){if(arguments.length>1){var i=this[t];if(i&&"function"==typeof e&&(!i.valueOf||i.valueOf()!=e.valueOf())&&/\bbase\b/.test(e)){var o=e.valueOf();e=function(){var t=this.base||n.prototype.base;this.base=i;var e=o.apply(this,arguments);return this.base=t,e},e.valueOf=function(t){return"object"==t?e:o},e.toString=n.toString}this[t]=e}else if(t){var r=n.prototype.extend;n._prototyping||"function"==typeof this||(r=this.extend||r);for(var s={toSource:null},a=["constructor","toString","valueOf"],u=n._prototyping?0:1;c=a[u++];)t[c]!=s[c]&&r.call(this,c,t[c]);for(var c in t)s[c]||r.call(this,c,t[c])}return this}},n=n.extend({constructor:function(){this.extend(arguments[0])},bind:function(t,e){return function(){return t.apply(e,arguments)}},bindAll:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=0,n=e.length;n>i;i++){var o=e[i];t[o]=this.bind(t[o],t)}return t}},{ancestor:Object,implement:function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?arguments[t](this.prototype):this.prototype.extend(arguments[t]);return this},toString:function(){return String(this.valueOf())}}),e.exports=n},{}],2:[function(t,e,i){var n=t("./class"),o=n.extend({constructor:function(t){this.geoProvider=t,this.bindAll(this,"positionUpdate","positionError")},watching:!1,watchId:null,options:null,geoProvider:null,last:null,getCurrentPosition:function(t,e,i){this.geoProvider.getCurrentPosition(t,e,i)},watchPosition:function(t,e,i){e&&ffwdme.on("geoposition:update",e),i&&ffwdme.on("geoposition:error",i),this.watching||(this.watchId=this.geoProvider.watchPosition(this.positionUpdate,this.positionError,t),this.options=t,this.watching=!0,ffwdme.trigger("geoposition:init"))},clearWatch:function(){this.geoProvider.clearWatch(this.watchId)},positionUpdate:function(t){var e={geoposition:t,point:new ffwdme.LatLng(t.coords.latitude,t.coords.longitude)},i=!1;this.last||(i=!0),this.last=e,i&&ffwdme.trigger("geoposition:ready",e),ffwdme.trigger("geoposition:update",e)},positionError:function(t){ffwdme.trigger("geoposition:error",{error:t})}});e.exports=o},{"./class":1}],3:[function(t,e,i){(function(e){var i=t("./class"),n=t("./geolocation"),o=t("./lat_lng"),r=t("./navigation"),s=t("./route"),a=t("./navigation_info"),u=t("./routing/base"),c=t("./routing/graph_hopper"),l=t("./routing/osrm"),h=t("./utils/geo"),f=t("./utils/proxy"),d=t("./utils/xhr");!function(t,e){var p={Class:i,Geolocation:n,LatLng:o,Navigation:r,NavigationInfo:a,Route:s,routing:{Base:u,GraphHopper:c,OSRM:l},utils:{Geo:h,Proxy:f,XHR:d},initialize:function(t){t=t||{},this.options=t,t.geoProvider||(t.geoProvider=window.navigator.geolocation),this.geolocation=new p.Geolocation(t.geoProvider),t.ingoreGeolocation||this.geolocation.watchPosition({enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),t.routing&&p.routing[t.routing]&&(this.routingService=p.routing[t.routing]),this.navigation=new p.Navigation},VERSION:"0.4.0",callbacks:null,defaults:{imageBaseUrl:"components/",audioBaseUrl:"components/audio_instructions/voices/"},options:{},geolocation:null,navigation:null,routingService:null,reset:function(){this.callbacks=null,this.geolocation&&this.geolocation.clearWatch(),this.geolocation=null,this.routingService=null,this.navigation=null},on:function(t,e){this.callbacks=this.callbacks||{};for(var i,n=t.split(" "),o=0,r=n.length;r>o;o++)i=n[o],this.callbacks[i]||(this.callbacks[i]=[]),this.callbacks[i].push(e);return this},once:function(t,e){var i=function(n){e(n),p.off(t,i)};return this.on(t,i),this},off:function(t,e){if(!this.callbacks||!this.callbacks[t])return this;for(var i=this.callbacks[t],n=0,o=i.length;o>n;n++)if(i[n]===e)return this.callbacks[t].splice(n,1),this;return this},trigger:function(t,e){if(this.callbacks=this.callbacks||{},!this.callbacks[t])return this;var i=this.callbacks[t];e||(e={}),e.type=t;for(var n=i.length,o=n-1;o>=0;o--)i[o](e);return this},toString:function(){return"ffwdme.js v"+this.VERSION}};t.ffwdme=p}("undefined"!=typeof window?window:e)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./class":1,"./geolocation":2,"./lat_lng":4,"./navigation":5,"./navigation_info":6,"./route":7,"./routing/base":8,"./routing/graph_hopper":9,"./routing/osrm":10,"./utils/geo":11,"./utils/proxy":12,"./utils/xhr":13}],4:[function(t,e,i){var n=function(t,e){"[object Array]"===toString.call(t)&&(e=t[1],t=t[0]),t=parseFloat(t),e=parseFloat(e),t=Math.max(Math.min(t,90),-90),e=(e+180)%360+(-180>e?180:-180),this.lat=t,this.lng=e};n.prototype={toString:function(){return"LatLng: "+this.lat+", "+this.lng}},e.exports=n},{}],5:[function(t,e,i){var n=t("./class"),o=t("./utils/geo"),r=n.extend({constructor:function(t){this.bindAll(this,"getPositionOnRoute","rerouteCallback")},route:null,_lastPositionsOnRoute:[],_currentPositionOnRoute:null,_lastDirectionPathIndex:null,_lastDrivingDirectionIndex:null,startTime:null,startTimeByDirection:{},offRouteCounter:0,offRouteStartTimestamp:0,routePointCounter:0,offRouteTime:0,reset:function(){this._lastPositionsOnRoute=[],this._currentPositionOnRoute=null,this._lastDirectionPathIndex=null,this._lastDrivingDirectionIndex=null,this.offRouteCounter=0,this.offRouteStartTimestamp=0,this.routePointCounter=0},setRoute:function(t){return this.reset(),this.route=t,this},reroute:function(t){t||(t={});var e=this.route.directions,i=e[e.length-1],n=i.path?i.path[i.path.length-1].lat:i.start.lat,o=i.path?i.path[i.path.length-1].lng:i.start.lng;ffwdme.on("reroutecalculation:success",this.rerouteCallback),t.dest=new ffwdme.LatLng(n,o),t.rerouting=!0;new ffwdme.routingService(t).fetch()},rerouteCallback:function(t){ffwdme.off("reroutecalculation:success",this.rerouteCallback),this.setRoute(t.route)},start:function(){this.getPositionOnRoute(ffwdme.geolocation.last),ffwdme.on("geoposition:update",this.getPositionOnRoute),this.startTime=Date.now()},stop:function(){ffwdme.off("geoposition:update",this.getPositionOnRoute)},notFoundOnRoute:function(t){0===this.offRouteCounter?this.offRouteStartTimestamp=Date.now():this.offRouteTime=Date.now()-this.offRouteStartTimestamp,this.offRouteCounter++,ffwdme.trigger("navigation:offroute",{navInfo:t})},getPositionOnRoute:function(t){var e,i=30;if(this._lastDrivingDirectionIndex)for(var n,o=this.approachInSteps(),r=o.length,s=0;r>s&&(n=o[s],e=this.route.nearestTo(t.point,n.dIndex,n.pIndex,n.max),!(e.point&&e.distance<i));s++);else e=this.route.nearestTo(t.point,0,0);this.routePointCounter++;var a=new ffwdme.NavigationInfo({nearest:e,raw:t,navigation:this,route:this.route,onRoute:!!(e.point&&e.distance<i)});return a.onRoute?(this.offRouteCounter=0,ffwdme.trigger("navigation:onroute",{navInfo:a})):this.notFoundOnRoute(a)},approachInSteps:function(){return[{dIndex:this._lastDrivingDirectionIndex,pIndex:this._lastDirectionPathIndex,max:2},{dIndex:Math.max(this._lastDrivingDirectionIndex-2,0),pIndex:0,max:5},{dIndex:Math.max(this._lastDrivingDirectionIndex-4,0),pIndex:0,max:10},{dIndex:0,pIndex:0,max:!1}]}}).implement(o);e.exports=r},{"./class":1,"./utils/geo":11}],6:[function(t,e,i){var n=t("./class"),o=n.extend({constructor:function(t){this.position=t.nearest.point,this.positionRaw=t.raw.point,this.nearest=t.nearest,this.raw=t.raw,this.navigation=t.navigation,this.route=t.route,this.finalDirection=this.nearest.directionIndex+1===this.route.directions.length,this.arrived=this.finalDirection&&ffwdme.utils.Geo.distance(this.positionRaw,this.route.destination())<=35,this.onRoute=t.onRoute,this.onRoute&&(this.currentDirection=this.route.directions[this.nearest.directionIndex],this.nextDirection=this.route.directions[this.nearest.directionIndex+1],this.calculateDistances(),this.calculateRatios(),this.calculateTimes())},calculateRatios:function(){var t=this.currentDirection.distance-this.distanceToNextDirection,e=t/this.currentDirection.distance,i=Math.round;e=i(100*e)/100,.01>e&&(e=.01),this.ratioCompletedDirection=e;var n=(this.route.summary.distance-this.distanceToDestination)/this.route.summary.distance;n=i(100*n)/100,.01>n&&(n=.01),this.ratioCompletedRoute=n},calculateTimes:function(){this.timeToNextDirection=Math.round((1-this.ratioCompletedRoute)*this.currentDirection.duration),this.timeToDestination=Math.round((1-this.ratioCompletedRoute)*this.route.summary.duration)},calculateDistances:function(){var t,e,i,n,o=ffwdme.utils.Geo,r=10,s=this.route.directions,a=this.route.directions[this.nearest.directionIndex],u=a.path[this.nearest.nextPathIndex],c=o.distance(this.position,u);for(t=c,i=this.nearest.nextPathIndex,n=a.path.length-1;n>i&&a.path[i+1];i++)t+=o.distance(a.path[i],a.path[i+1]);for(t>=10&&(t-=r),this.distanceToNextDirection=t,e=t,i=this.nearest.directionIndex+1,n=s.length;n>i;i++)e+=s[i].distance;this.distanceToDestination=e},nearest:null,raw:null,positionRaw:null,position:null,distanceToNextDirection:null,distanceToDestination:null,timeToNextDirection:null,timeToDestination:null,ratioCompletedDirection:null,ratioCompletedRoute:null,nextDirection:null,finalDirection:null,arrived:null});e.exports=o},{"./class":1}],7:[function(t,e,i){var n=t("./class"),o=t("./utils/geo"),r=n.extend({constructor:function(){},summary:null,directions:null,parse:function(t){this.summary=t.summary,this.directions=t.directions;for(var e=0,i=this.directions.length;i>e;e++){for(var n=this.directions[e].path,o=[],r=0,s=n.length;s>r;r++)o.push(new ffwdme.LatLng(n[r][0],n[r][1]));this.directions[e].path=o}return this},start:function(){var t=this.directions[0],e=t.path[0];return e},destination:function(){var t=this.directions[this.directions.length-1],e=t.path[t.path.length-1];return e},nearestTo:function(t,e,i,n){for(var r={distance:999999,point:null,directionIndex:null,prevPathIndex:null,nextPathIndex:null},s=o,a=n?Math.min(n,this.directions.length):this.directions.length,u=e;a>u;u++)for(var c=this.directions[u],l=c.path.length-1,h=u===e?i:0,f=h;l>f;f++){var d=s.closestOnLine(c.path[f],c.path[f+1],t),p=s.distance(t,d);r.distance<p||(r.distance=p,r.point=d,r.directionIndex=u,r.prevPathIndex=f,r.nextPathIndex=f+1)}return r}},{decodePolyline:function(t,e){for(var i=1/Math.pow(10,e||5),n=t.length,o=0,r=[],s=0,a=0;n>o;){var u,c=0,l=0;do u=t.charCodeAt(o++)-63,l|=(31&u)<<c,c+=5;while(u>=32);var h=1&l?~(l>>1):l>>1;s+=h,c=0,l=0;do u=t.charCodeAt(o++)-63,l|=(31&u)<<c,c+=5;while(u>=32);var f=1&l?~(l>>1):l>>1;a+=f,r.push([s*i,a*i])}return r}});e.exports=r},{"./class":1,"./utils/geo":11}],8:[function(t,e,i){var n=t("../class"),o=n.extend({constructor:function(t){this.options=t;for(var e,i=["start","dest","rerouting"],n=0,o=i.length;o>n;n++)e=i[n],this[e]=t&&t[e];return this.start||(this.start=ffwdme.geolocation.last.point),this},options:null,lastRoute:null,fetch:function(){throw"ffwdme.routing.Base is an abstract class. You must use a child class."},eventPrefix:function(){return this.rerouting?"reroutecalculation":"routecalculation"},success:function(t,e){this.lastRoute=e,ffwdme.trigger(this.eventPrefix()+":success",{routing:this,route:e,response:t})},error:function(t){ffwdme.trigger(this.eventPrefix()+":error",{routing:this,error:t})}});e.exports=o},{"../class":1}],9:[function(t,e,i){var n=t("./base"),o=n.extend({constructor:function(t){this.base(t),this.bindAll(this,"parse","error"),this.apiKey=ffwdme.options.graphHopper.apiKey,t.anchorPoint&&(this.anchorPoint=t.anchorPoint,this.direction=this.start,this.start=this.anchorPoint)},BASE_URL:"http://graphhopper.com/api/1/",apiKey:null,modifier:"fastest",routeType:"car",lang:"en_EN",route:null,anchorPoint:null,direction:null,fetch:function(){var t="";this.direction&&(t+="&point="+[this.direction.lat,this.direction.lng].join("%2C"));var e=[this.BASE_URL,"route?type=jsonp","&key=",this.apiKey,"&locale=",this.lang,"&vehicle=",this.routeType,"&weighting=",this.modifier,"&point=",[this.start.lat,this.start.lng].join("%2C"),t,"&point=",[this.dest.lat,this.dest.lng].join("%2C")];return ffwdme.trigger(this.eventPrefix()+":start",{routing:this}),ffwdme.utils.Proxy.get({url:e.join(""),success:this.parse,error:this.error}),ffwdme},error:function(t){this.base(t)},parse:function(t){if(t.info.errors)return this.error(t);var e=t.paths[0],i={directions:[]};i.summary={distance:parseInt(e.distance,10),duration:e.time/1e3};var n,o,r,s=ffwdme.Route.decodePolyline(e.points),a=e.instructions;a.pop();for(var u=0,c=a.length;c>u;u++)n=a[u],o={instruction:n.text,distance:parseInt(n.distance,10),duration:n.time/1e3,turnAngle:this.extractTurnAngle(n.sign),turnType:this.extractTurnType(n.sign)},o.path=s.slice(n.interval[0],n.interval[1]+1),r=o.instruction.split(/(?:on |near |onto |at |Head )/).pop(),o.street=r.length==o.instruction.length?"":r,i.directions.push(o);this.route=(new ffwdme.Route).parse(i),this.success(t,this.route)},extractTurnType:function(t){var e;switch(t){case 0:e="C";break;case-2:e="TL";break;case-1:e="TSLL";break;case-3:e="TSHL";break;case 2:e="TR";break;case 1:e="TSLR";break;case 3:e="TSHR"}return e},extractTurnAngle:function(t){var e;switch(t){case 0:e=0;break;case-2:e=90;break;case-1:e=45;break;case-3:e=135;break;case 2:e=-90;break;case 1:e=-45;break;case 3:e=-135}return e}});e.exports=o},{"./base":8}],10:[function(t,e,i){var n=t("./base"),o=n.extend({constructor:function(t){this.base(t),this.bindAll(this,"parse","error"),this.apiKey=ffwdme.options.OSRM?ffwdme.options.OSRM.apiKey:"",t.anchorPoint&&(this.anchorPoint=t.anchorPoint,this.direction=this.start,this.start=this.anchorPoint)},BASE_URL:"https://router.project-osrm.org",apiKey:null,modifier:"fastest",routeType:"car",lang:"en_EN",route:null,anchorPoint:null,direction:null,zoom:18,fetch:function(){var t="";this.direction&&(t+="&loc="+[this.direction.lat,this.direction.lng].join("%2C"));var e=[this.BASE_URL,"/","viaroute?","instructions=true","&alt=false",this.apiKey?"&key="+this.apiKey:"","&z=",this.zoom,"&loc=",[this.start.lat,this.start.lng].join("%2C"),t,"&loc=",[this.dest.lat,this.dest.lng].join("%2C")];return ffwdme.trigger(this.eventPrefix()+":start",{routing:this}),ffwdme.utils.XHR.get({url:e.join(""),success:this.parse,error:this.error,callback:null}),ffwdme},error:function(t){this.base(t)},parse:function(t){if(200!==t.status)return this.error(t);var e={directions:[]};e.summary={distance:parseInt(t.route_summary.total_distance,10),duration:parseInt(t.route_summary.total_time,10)};var i,n,o=ffwdme.Route.decodePolyline(t.route_geometry,6),r=t.route_instructions;r.pop();for(var s=0,a=r.length;a>s;s++){i=r[s],n={street:i[1],instruction:i[1],distance:parseInt(i[2],10),duration:i[4]/1e3,turnAngle:i[10],turnType:this.extractTurnType(i[0])};var u=s+1>=a?a-1:s+1;n.path=o.slice(i[3],r[u][3]+1),e.directions.push(n)}this.route=(new ffwdme.Route).parse(e),this.success(t,this.route)},extractTurnType:function(t){switch(parseInt(t,10)){case 1:return"C";case 2:return"TSLR";case 3:return"TR";case 4:return"TSHR";case 5:return"TU";case 6:return"TSHL";case 7:return"TL";case 8:return"TSLL";case 9:return;case 10:return"C";case 11:case 12:return;case 15:return;default:return}}});e.exports=o},{"./base":8}],11:[function(t,e,i){e.exports={EARTH_RADIUS:6378137,DEG_TO_RAD_FACTOR:Math.PI/180,distance:function(t,e){var i=t.lat*this.DEG_TO_RAD_FACTOR,n=e.lat*this.DEG_TO_RAD_FACTOR,o=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-t.lng)*this.DEG_TO_RAD_FACTOR);return parseInt(this.EARTH_RADIUS*Math.acos(Math.min(o,1)))},closestOnLine:function(t,e,i){var n=t.lat,o=t.lng,r=e.lat,s=e.lng,a=i.lat,u=i.lng,c=r-n,l=s-o;if(0===c&&0===l)return t;var h,f=((a-n)*c+(u-o)*l)/(c*c+l*l);return h=0>f?[n,o]:f>1?[r,s]:[n+f*c,o+f*l],new ffwdme.LatLng(h[0],h[1])}}},{}],12:[function(t,e,i){var n={_tags:{},callbacks:{},errorCallbacks:{},successfullCallbacks:{},devNull:function(){},_idCounter:0,_idPrefix:"ffwdme-Proxy-",_callbackPrefix:"ffwdme.utils.Proxy.callbacks.",_headTag:document.getElementsByTagName("head")[0],checkForTimeout:function(t){this.successfullCallbacks[t]!==!0&&this.errorCallbacks[t]()},removeTimeoutCheck:function(t){this.callbacks[t]=this.devNull,delete this.errorCallbacks[t]},get:function(t){t=t||{};var e=t.callback||"callback",i=this._idPrefix+this._idCounter++,n="cb"+this._idCounter,o=this,r=[t.url,t.url.indexOf("?")>-1?"&":"?",e,"=",this._callbackPrefix,n].join(""),s=this.buildScriptTag(r,i),a=t.success;this.callbacks[n]=function(t){o.successfullCallbacks[n]=!0,o.removeTimeoutCheck(n),a&&a(t)};var u=t.error;this.errorCallbacks[n]=function(){o.removeTimeoutCheck(n),u&&u({error:"timeout"})},this._tags[i]=s,this._headTag.appendChild(s),window.setTimeout(ffwdme.Class.prototype.bind.call(this,this.checkForTimeout,this),t.timeout||1e4,n)},buildScriptTag:function(t,e){var i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("charset","utf-8"),i.setAttribute("src",t),i.setAttribute("id",e),i},removeScriptTag:function(t){this._tags[t]&&(this._headTag.removeChild(this._tags[t]),delete this._tags[t])}};e.exports=n},{}],13:[function(t,e,i){var n={get:function(t){this._request(t)},_request:function(t){var e=t.success||function(){},i=t.error||function(){},n=t.method||"GET",o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?e(this._parseResponse(o)):i(o))}.bind(this),o.open(n,t.url,!0),o.send()},_parseResponse:function(t){var e=t.getResponseHeader("Content-Type");if(!e||-1===e.indexOf("application/json"))return t.responseText;try{return JSON.parse(t.responseText)}catch(i){return t.responseText}}};e.exports=n},{}]},{},[3]);